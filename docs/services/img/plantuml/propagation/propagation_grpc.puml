@startuml

participant "gRPC Client" as Client
participant "gRPC Server" as Server
participant "PropagationServer" as PropagationServer
participant "Tx Store" as TxStore
participant "Kafka Producer" as KafkaProducer
participant "Validator" as Validator

Client -> Server: Send gRPC request (ProcessTransaction)
activate Server

Server -> PropagationServer: Invoke ProcessTransaction
activate PropagationServer

PropagationServer -> TxStore: storeTransaction(ctx, tx)
activate TxStore
TxStore --> PropagationServer: Storage confirmation
deactivate TxStore

alt if Kafka Producer is configured
    PropagationServer -> KafkaProducer: Send transaction
    activate KafkaProducer
    KafkaProducer --> PropagationServer: Confirmation
    deactivate KafkaProducer
else if direct validation
    PropagationServer -> Validator: Validate(ctx, tx)
    activate Validator
    Validator --> PropagationServer: Validation response
    deactivate Validator
end

PropagationServer --> Server: Send response
deactivate PropagationServer
Server -> Client: Return response
deactivate Server

left footer Last Modified On: %date("dd-MMM-yyyy")

@enduml
