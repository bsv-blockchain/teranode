@startuml
queue "catchupCh\nCatchup Channel" as CatchupCh
participant "Validation Service" as ValidationService
entity "Block Validation\n(BlockValidation.go)" as BVVB
participant "Blockchain Client" as BC
participant "Util HTTP Request" as Util

CatchupCh -> ValidationService: catchup(ctx, fromBlock, baseURL)
activate ValidationService

ValidationService -> BC: GetBlockExists(ctx, fromBlock.Hash())
BC --> ValidationService: exists / not exists

alt Block does not exist
    ValidationService -> ValidationService: getBlockHeaders(ctx, fromBlock.Header.HashPrevBlock, baseURL)
    ValidationService -> ValidationService: Reverse blockHeaders

    loop For each batch of block headers
        loop For each blockHeader in batch
            ValidationService -> BC: GetBlockExists(ctx, blockHeader.Hash())
            BC --> ValidationService: exists / not exists

            alt Block does not exist
                ValidationService -> Util: getBlocks(ctx, blockHeader.Hash(), batchSize, baseURL)
                Util --> ValidationService: blocks

                loop For each block
                    ValidationService -> BVVB: ValidateBlock(ctx, block, baseURL)
                end
            end
        end
    end
end

ValidationService --> CatchupCh: Catchup complete
deactivate ValidationService

left footer Last Modified On: %date("dd-MMM-yyyy")

@enduml
